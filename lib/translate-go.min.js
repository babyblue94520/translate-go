var TranslateModule=function(t){"use strict";function n(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);function o(){this.constructor=t}t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}var r,e;(e=r||(r={}))[e.none=0]="none",e[e.key=1]="key";var o=function(){function t(){this._nodes=[]}return t.prototype.indexOf=function(t){return this._nodes.indexOf(t)},t.prototype.getNodes=function(){return this._nodes},t.prototype.add=function(t){this._nodes.push(t)},t.prototype.remove=function(t){var e=this.indexOf(t);return-1!=e&&(this._nodes.splice(e,1),!0)},t.prototype.clean=function(){this._nodes=this._nodes.filter(this.cleanFilterHandler)},t.prototype.cleanFilterHandler=function(t){return t&&t.isConnected},t}(),a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.need=function(t){return("INPUT"==t.tagName||"TEXTAREA"==t.tagName)&&t.placeholder},e.prototype.getText=function(t){return t.placeholder},e.prototype.setText=function(t,e){e&&(t.placeholder=e)},e}(o),s=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return n(e,t),e.prototype.need=function(t){return 3==t.nodeType},e.prototype.getText=function(t){return t.data},e.prototype.setText=function(t,e){e&&(t.data=e)},e}(o),i=function(){function t(t){this._dev=t,this._specialChars="[.。:：;；!！?？{}()=＊*\\[\\]\\s\\r\\n]",this._startRegexStr="([{(＊*\\[\\s\\r\\n]?^)",this._endRegexStr="([.。:：;；!！?？=＊*\\]\\s\\r\\n]?$)",this._cleanChars="[\\r\\n]",this._modifier="i",this._cleanRegex=new RegExp(this._cleanChars+"+","g"),this._textReplaceSpecialCharsRegex=new RegExp("("+this._specialChars+")","g"),this._wordSource={},this._keySource={},this._wordRegexs=[],this._textLanguageData={},this._langs=[],this._cacheNonTranslateText={}}return t.prototype.getLanguages=function(){return this._langs},t.prototype.hasLanguage=function(t){return-1!=this._langs.indexOf(t)},t.prototype.insert=function(t){var e=this;console.log("_loadLanguageData start");var n,o,a,r=performance.now();for(var s in t)for(var i in-1==e._langs.indexOf(s)&&e._langs.push(s),a=t[s])n=a[i],(o=e._keySource[i])||(o=e._keySource[i]={}),o[s]=n,e._wordSource[n]=o,e._wordRegexs[n]=new RegExp(e._startRegexStr+e.getRegexText(n)+e._endRegexStr,e._modifier),e._textLanguageData[n]=s;console.log("_loadLanguageData end",performance.now()-r)},t.prototype.getNonTranslate=function(){var t={},e=0<this._langs.length?this._langs:["zh_TW"],n=0;for(var o in e)for(var a in t[e[o]]={},n=0,this._cacheNonTranslateText)t[e[o]][n++]=a;return t},t.prototype.translate=function(t,e){var n=t;if(0<(t=String(t)).length){var o=this.getWordSource(t);if(o)return o[e]||n;var a=this.getTranslateSource(t);if(o)return this.translateBySource(t,a,e)||n}return n},t.prototype.translateByKey=function(t,e){var n,o=this._keySource[t];return o&&(n=o[e]||n,o.currentLanguage=e,o.translateText=n,o.currentText=n),n},t.prototype.translateBySource=function(t,e,n){var o=e.translateRegexs[e.currentLanguage],a=e.wordSource[n];if(null!=a)return e.currentLanguage=n,e.translateText=a,e.currentText=t.replace(o,"$1"+a+"$2"),e.currentText},t.prototype.getTranslateSource=function(t){var e=this.getTextLanguage(t);if(e){var n={},o=this.getWordSource(e.text);if(o){for(var a in o)n[a]=this.getWordRegex(o[a]);return{type:r.none,translateText:e.text,currentLanguage:e.language,wordSource:o,translateRegexs:n,currentText:t}}}},t.prototype.getTranslateSourceByKey=function(t){return{type:r.key,translateText:null,currentLanguage:null,wordSource:this._keySource[t],translateRegexs:null,currentText:null}},t.prototype.getTextLanguage=function(t){var e=this._textLanguageData[t];if(e)return{language:e,text:t};var n=this.getCleanText(t);if(0!=n.length){if(e=this._textLanguageData[n])return{language:e,text:n};for(var o in this._textLanguageData)if(this.getWordRegex(o).test(n))return{language:this._textLanguageData[o],text:o};if(this._dev&&n){var a=n.replace(/[&@#$%^\[\]'"～`~<>,，+-_.。:：;；!！?？{}()=＊*\/\[\]\s\r\n]/g,"");isNaN(Number(a))&&!/^[0-9]+$/.test(a)&&(this._cacheNonTranslateText[n]=!1)}}},t.prototype.getWordSource=function(t){return this._wordSource[t]},t.prototype.getWordRegex=function(t){return this._wordRegexs[t]},t.prototype.getCleanText=function(t){return t?t.replace(this._cleanRegex,"").replace(/(^[\s]+|[\s]+$)/g,""):t},t.prototype.getRegexText=function(t){return t.replace(this._textReplaceSpecialCharsRegex,"\\$1")},t}(),d=function(t){var a=this;this.translateGO=t,this.toolUrl="https://babyblue94520.github.io/translate-go-tool/dist/#/Index",this.toolOrigin="https://babyblue94520.github.io",this.start=function(t){a.translateGO.watch(),a.status(!0)},this.stop=function(t){a.translateGO.stop(),a.status(!1)},this.languageChange=function(t){a.translateGO.translate(a._languageSelect.value)},this.openTool=function(t){!a.toolWindow||a.toolWindow.closed?(a.toolWindow=window.open(a.toolUrl,a.toolOrigin),setTimeout(function(){a.toolWindow.postMessage(a.translateGO.getNonTranslateText(),a.toolOrigin)},2e3)):a.toolWindow.focus()},this.postNonText=function(t){a.toolWindow&&(a.toolWindow.postMessage(a.translateGO.getNonTranslateText(),a.toolOrigin),a.toolWindow.focus())},this.status=function(t){t?(a._startWatchButton.disabled=!0,a._stopWatchButton.disabled=!1):(a._startWatchButton.disabled=!1,a._stopWatchButton.disabled=!0)},this.updateLanaguageOption=function(t){if(a._languageSelect){a._languageSelect.innerHTML="";var e=void 0,n=void 0;for(var o in t)n=t[o],(e=document.createElement("option")).value=n,e.innerText=n,a._languageSelect.appendChild(e)}},this.changeLanaguage=function(t){a._languageSelect.value=t};var e=document.createElement("style");e.innerHTML=[".translate-toolbar{","position: fixed;z-index: 999;bottom: 0px;left: 0;","}",".translate-toolbar>button,.translate-toolbar>select{","padding: 10px;margin: 5px;display: inline-block; box-shadow: rgba(0, 0, 0, 0.25) 0px 5px 15px, rgba(0, 0, 0, 0.22) 0px 3px 10px;","}",".translate-toolbar>button:disabled,.translate-toolbar>select:disabled{","background-color:#fff;color:#ccc;","box-shadow: rgba(0, 0, 0, 0.25) 0px 1px 1px","}"].join(""),document.head.appendChild(e),this._element=document.createElement("div"),this._element.className="translate-toolbar",this._element.setAttribute("notTranslate",""),this._languageSelect=document.createElement("select"),this._languageSelect.addEventListener("change",this.languageChange),this._startWatchButton=document.createElement("button"),this._startWatchButton.innerText="start",this._startWatchButton.addEventListener("click",this.start),this._stopWatchButton=document.createElement("button"),this._stopWatchButton.innerText="stop",this._stopWatchButton.addEventListener("click",this.stop),this._openToolWindowButton=document.createElement("button"),this._openToolWindowButton.innerText="open",this._openToolWindowButton.addEventListener("click",this.openTool),this._postNonTextButton=document.createElement("button"),this._postNonTextButton.innerText="post",this._postNonTextButton.addEventListener("click",this.postNonText),this._element.appendChild(this._languageSelect),this._element.appendChild(this._startWatchButton),this._element.appendChild(this._stopWatchButton),this._element.appendChild(this._openToolWindowButton),this._element.appendChild(this._postNonTextButton),document.body?document.body.appendChild(this._element):window.onload=function(t){document.body.appendChild(a._element)}},l=function(){function t(t,e){var n=this;this.isWatch=!1,this.translateTextNodes=new s,this.translatePlaceholderNodes=new a,this.ignoreTagArray=["SCRIPT","LINK","META","STYLE"],this.ignoreAttributeName="notTranslate",this.keyAttributeName="translateKey",this.windowAlert=window.alert,this.windowConfirm=window.confirm,this.proxyAlertHanlder=function(t){n.windowAlert.call(window,n.getText(t))},this.proxyConfirmHanlder=function(t){return n.windowConfirm.call(window,n.getText(t))},this.domNodeInserted=function(t){n.nodeHandler(t.target)},this.domSubtreeModified=function(t){var e=t.target;n.translateTextNodes.need(e)&&n.isNonIgnore(e)&&n.modifyAddNode(n.translateTextNodes,e)},this.currentLanguage=t||navigator.language,this.db=new i(e),e&&(this.toolbar=new d(this),this.toolbar.updateLanaguageOption(this.db.getLanguages()),this.toolbar.changeLanaguage(this.currentLanguage))}return t.prototype.getTranslateNode=function(){return this.translateTextNodes},t.prototype.getNonTranslateText=function(){return this.db.getNonTranslate()},t.prototype.loadLanguageData=function(t){this.db.insert(t),this.toolbar&&(this.toolbar.updateLanaguageOption(this.db.getLanguages()),this.toolbar.changeLanaguage(this.currentLanguage)),this.isWatch&&this.loadTextNodes()},t.prototype.getLanguage=function(){return this.currentLanguage},t.prototype.getText=function(t){return"string"==typeof t?this.db.translate(t,this.currentLanguage):t},t.prototype.getTextByKey=function(t){return this.db.translateByKey(t,this.currentLanguage)},t.prototype.translate=function(t){if(this.currentLanguage!=t&&this.db.hasLanguage(t)){var e=u();console.log("doTranslate start"),this.currentLanguage=t,this.doTranslate(),console.log("doTranslate end",u()-e+"ms"),this.toolbar&&this.toolbar.changeLanaguage(this.currentLanguage)}},t.prototype.watch=function(){this.stop(),this.isWatch=!0,console.log("find text node start");var t=u();this.loadTextNodes(),console.log("find text node end",u()-t+"ms"),t=u(),this.doTranslate(),console.log("doTranslate end",u()-t+"ms"),window.alert=this.proxyAlertHanlder,window.confirm=this.proxyConfirmHanlder,document.addEventListener("DOMNodeInserted",this.domNodeInserted),document.addEventListener("DOMSubtreeModified",this.domSubtreeModified),document.addEventListener("DOMNodeInsertedIntoDocument",this.domNodeInserted),this.toolbar&&this.toolbar.status(!0)},t.prototype.stop=function(){this.isWatch=!1,window.alert=this.windowAlert,window.confirm=this.windowConfirm,document.removeEventListener("DOMNodeInserted",this.domNodeInserted),document.removeEventListener("DOMSubtreeModified",this.domSubtreeModified),document.removeEventListener("DOMNodeInsertedIntoDocument",this.domNodeInserted),this.toolbar&&this.toolbar.status(!1)},t.prototype.isNonIgnore=function(t){return 3==t.nodeType&&(t=t.parentElement),1==t.nodeType&&(-1==this.ignoreTagArray.indexOf(t.tagName)&&null==t.getAttribute(this.ignoreAttributeName))},t.prototype.nodeHandler=function(t){this.isNonIgnore(t)&&(this.translateTextNodes.need(t)?this.addNode(this.translateTextNodes,t):this.translatePlaceholderNodes.need(t)&&this.addNode(this.translatePlaceholderNodes,t),this.loopNodes(t.childNodes))},t.prototype.loopNodes=function(t){if(0!=t.length)for(var e=0,n=t.length;e<n;e++)this.nodeHandler(t[e])},t.prototype.loadTextNodes=function(){document.head&&this.nodeHandler(document.head),document.body&&this.nodeHandler(document.body)},t.prototype.doTranslate=function(){this.translateTextNodes.clean();for(var t=this.translateTextNodes.getNodes(),e=0,n=t.length;e<n;e++)this.doTranslateNodesSetText(this.translateTextNodes,t[e]);this.translatePlaceholderNodes.clean();for(e=0,n=(t=this.translatePlaceholderNodes.getNodes()).length;e<n;e++)this.doTranslateNodesSetText(this.translatePlaceholderNodes,t[e])},t.prototype.addNode=function(t,e){this.updateNode(t,e)||this.addTranslateSource(t,e)&&(this.doTranslateNodesSetText(t,e),t.add(e))},t.prototype.modifyAddNode=function(t,e){this.updateNode(t,e)||this.isCanAddNode(e)&&this.addTranslateSource(t,e)&&(this.doTranslateNodesSetText(t,e),t.add(e))},t.prototype.isCanAddNode=function(t){for(var e=t;(e=e.parentElement)!=document.documentElement;)if(null!=e.getAttribute(this.ignoreAttributeName))return!1;return!0},t.prototype.updateNode=function(t,e){if(e.translateTextSource){if(e.translateTextSource.currentText==t.getText(e))return!0;if(this.addTranslateSource(t,e))return this.doTranslateNodesSetText(t,e),!0}return!1},t.prototype.addTranslateSource=function(t,e){var n=e.parentElement.getAttribute(this.keyAttributeName);if(n)return e.translateTextSource=this.db.getTranslateSourceByKey(n);var o=t.getText(e);return null!=o&&0!=String(o).length&&(e.translateTextSource=this.db.getTranslateSource(o))},t.prototype.doTranslateNodesSetText=function(t,e){e.translateTextSource.type==r.key?t.setText(e,e.translateTextSource.wordSource[this.currentLanguage]):t.setText(e,this.db.translateBySource(t.getText(e),e.translateTextSource,this.currentLanguage))},t}();function u(){return(new Date).getTime()}return t.TranslateGO=l,t}({});

var TranslateModule=function(e){"use strict";function t(){return window[r.Prefix]?window[r.Prefix]:window[r.Prefix]=new h}var n={production:!1},r={Repeat:"repeat",Type:"type",Value:"value",Key:"key",IgnoreKeyArray:["key","type","repeat"],IgnoreTagArray:["SCRIPT","LINK","META","STYLE"],IgnoreAttributeName:"nottranslate",Translatekey:"translatekey",PlaceholderTranslatekey:"placeholdertranslatekey",Placeholder:"placeholder",Prefix:"__translateGO",GroupPrefix:"__translateGO_",ConfigPrefix:"__translateGOConfig"};void 0==window[r.ConfigPrefix]&&(window[r.ConfigPrefix]={dev:!n.production,defaultLanguage:"en"});var o,a=window[r.ConfigPrefix];!function(e){e[e.none=0]="none",e[e.key=1]="key"}(o||(o={}));var i=function(){this._special="([$/+?.。:：;；!！?？=＊*(){}|\\-\\^\\[\\]\\s\\r\\n\\\\]*)",this._startRegexStr="^"+this._special,this._endRegexStr=this._special+"$",this._modifier="i",this._cleanRegex=new RegExp(this._startRegexStr+"|"+this._endRegexStr,"g"),this._cleanStartRegex=new RegExp(this._startRegexStr,"g"),this._cleanEndRegex=new RegExp(this._endRegexStr,"g"),this._jumpRegex=new RegExp("([$/*+?.(){}|\\^\\[\\]\\\\])","g"),this._wordSource={},this._keySource={},this._wordRegexs={},this._textLangs={},this._langs=[],this._cacheNonTranslateText={}};i.prototype.getLanguages=function(){return this._langs},i.prototype.hasLanguage=function(e){return-1!=this._langs.indexOf(e)},i.prototype.insert=function(e){var t,n;for(var o in e){n={source:t=e[o],regexps:{},replaces:{}};for(var i in t){var s=String(t[i]),d=void 0;if(i==r.Key)this._keySource[o]=n;else{var u=s.split("(.+)");if(u.length>1){var l="$1";u[0]=this.getRegexWord(u[0].replace(this._cleanStartRegex,"")),l+=u[0]+"$2";for(var c=1,h=u.length-1;c<h;c++)u[c]=this.getRegexWord(u[c]),l+=u[c]+"$"+(c+2);c<u.length&&(u[c]=this.getRegexWord(u[c].replace(this._cleanEndRegex,"")),l+=u[c]+"$"+(c+2)),n.regexps[i]=this._wordRegexs[s]=new RegExp(this._startRegexStr+u.join("(.+)")+this._endRegexStr,this._modifier),n.replaces[i]=l}else d=this.cleanWord(s),n.regexps[i]=this._wordRegexs[s]=new RegExp(this._startRegexStr+this.getRegexWord(d)+this._endRegexStr,this._modifier),n.replaces[i]="$1"+d+"$2";this._wordSource[s]=n,this._textLangs[s]=i}a.dev&&(void 0!=d&&delete this._cacheNonTranslateText[d],delete this._cacheNonTranslateText[s],delete this._cacheNonTranslateText[o])}}if(t)for(var g in t)g!=r.Key&&-1==this._langs.indexOf(g)&&this._langs.push(g)},i.prototype.getNonTranslate=function(){return this._cacheNonTranslateText},i.prototype.translate=function(e,t){var n=e;if((e=String(e)).length>0){var r=this._wordSource[e];if(r)return r.source[t]||n;var o=this.getTranslateSource(e);if(o)return this.translateBySource(e,o,t)||n}return n},i.prototype.translateByKey=function(e,t){var n,r=this._keySource[e];return r&&(n=r.source[t]||n,r.currentLanguage=t,r.translateText=n,r.currentText=n),n},i.prototype.translateBySource=function(e,t,n){var r=t.dbSource.source[n];if(t.type==o.key)return t.currentLanguage=n,t.translateText=r,t.currentText=r,r;if(void 0!=r)return t.translateText=r,t.currentText=e.replace(t.dbSource.regexps[t.currentLanguage],t.dbSource.replaces[n]),t.currentLanguage=n,t.currentText},i.prototype.getTranslateSource=function(e){var t=this.getTextLanguage(e);if(t){var n=this._wordSource[t.text];if(n)return{type:o.none,translateText:t.text,currentLanguage:t.language,dbSource:n,currentText:e}}},i.prototype.getTranslateSourceByKey=function(e){var t=this._keySource[e];if(t)return{type:o.key,translateText:null,currentLanguage:null,dbSource:t,currentText:null}},i.prototype.getTranslateSourceAndLogByKey=function(e,t){var n=this.getTranslateSourceByKey(e);return a.dev&&void 0==n&&this.setCacheNonTranslate(e,t),n},i.prototype.getTextLanguage=function(e){var t=this._textLangs[e];if(t)return{language:t,text:e};var n=this.cleanWord(e);if(0!=n.length){if(t=this._textLangs[n])return{language:t,text:n};for(var r in this._textLangs)if(this._wordRegexs[r].test(n))return{language:this._textLangs[r],text:r};a.dev&&n&&isNaN(Number(n))&&!/^[0-9]+$/.test(n)&&this.setCacheNonTranslate("",n)}},i.prototype.setCacheNonTranslate=function(e,t){var n={};n[r.Key]=e,n[a.defaultLanguage]=t,this._cacheNonTranslateText[e||t]=n},i.prototype.cleanWord=function(e){return e.replace(this._cleanRegex,"")},i.prototype.getRegexWord=function(e){return e.replace(this._jumpRegex,"\\$1")};var s=function(){};s.getParentElement=function(e){return void 0!=e.parentElement?e.parentElement:void 0!=e.parentNode?e.parentNode:void 0},s.isConnected=function(e){if(!e)return!1;var t;if(void 0==e.isConnected){var n=s.getParentElement(e);n||(t=!1),t=e==document.body||n==document.body||s.isConnected(n)}else t=e.isConnected;return t||(e.translateTextSource=void 0),t};var d=function(e){this.db=e,this._nodes=[]};d.prototype.add=function(e){e.translateTextSource?e.translateTextSource.currentText!=this.getText(e)&&this.addSource(e)&&this.doSetText(e):this.addSource(e)&&(this.doSetText(e),this._nodes.push(e))},d.prototype.remove=function(e){var t=this._nodes.indexOf(e);return-1!=t&&(e.translateTextSource=void 0,this._nodes.splice(t,1),!0)},d.prototype.getNodes=function(){return this._nodes},d.prototype.clean=function(){this._nodes=this._nodes.filter(s.isConnected)},d.prototype.translateBySource=function(e,t,n){var r=t.dbSource.source[n];if(t.type==o.key)return t.currentLanguage=n,t.translateText=r,t.currentText=r,r;if(void 0!=r)return t.translateText=r,t.currentText=e.replace(t.dbSource.regexps[t.currentLanguage],t.dbSource.replaces[n]),t.currentLanguage=n,t.currentText},d.prototype.doTranslate=function(e){this._lang=e;for(var t=0,n=this._nodes.length;t<n;t++)this.doSetText(this._nodes[t])},d.prototype.addSource=function(e){var t=this.findKeyText(e);if(t)return void 0!=t.key?e.translateTextSource=this.db.getTranslateSourceAndLogByKey(t.key,t.text):(t.text=this.getText(e),void 0!=t.text&&0!=String(t.text).length&&(/^\w*$/.test(t.text)&&(e.translateTextSource=this.db.getTranslateSourceByKey(t.text),e.translateTextSource)?e.translateTextSource:e.translateTextSource=this.db.getTranslateSource(t.text)))},d.prototype.doSetText=function(e){var t=this.db.translateBySource(this.getText(e),e.translateTextSource,this._lang);this.setText(e,t)};var u=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.need=function(e){return void 0!=e.placeholder&&""!=e.placeholder||void 0!=e.getAttribute(r.PlaceholderTranslatekey)},t.prototype.getText=function(e){return e.placeholder},t.prototype.setText=function(e,t){t&&(e.placeholder=t)},t.prototype.findKeyText=function(e){var t,n=e.getAttribute(r.PlaceholderTranslatekey);return void 0!=n&&(void 0!=(t=e.getAttribute(r.Placeholder))&&""!=t||(t=n,e.setAttribute(r.Placeholder,n))),{key:n,text:t}},t}(d),l=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.need=function(e){return"INPUT"==e.tagName&&e.type&&"submit"==e.type.toLowerCase()&&(void 0!=e.value||void 0!=e.getAttribute(r.Translatekey))},t.prototype.getText=function(e){return e.value},t.prototype.setText=function(e,t){t&&(e.value=t)},t.prototype.findKeyText=function(e){return{key:e.getAttribute(r.Translatekey),text:e.value}},t}(d),c=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.need=function(e){return 3==e.nodeType},t.prototype.getText=function(e){return e.data},t.prototype.setText=function(e,t){t&&(e.data=t)},t.prototype.findKeyText=function(e){return{key:s.getParentElement(e).getAttribute(r.Translatekey),text:e.data}},t}(d),h=function(){var e=this;this.watch=!1,this.db=new i,this.currentLanguage=a.defaultLanguage||navigator.language,this.translateTexts=new c(this.db),this.translatePlaceholders=new u(this.db),this.translateSubmits=new l(this.db),this.translateNodes=[this.translateTexts,this.translatePlaceholders,this.translateSubmits],this.windowAlert=window.alert,this.windowConfirm=window.confirm,this.elementSetAttributeOrigin=Element.prototype.setAttribute,this.notLoadTextNodes=!0,this.notCleanTextNodes=!0,this.proxyAlertHanlder=function(t){e.windowAlert.call(window,e.getText(t))},this.proxyConfirmHanlder=function(t){return e.windowConfirm.call(window,e.getText(t))},this.domNodeInserted=function(t){e.nodeHandler(t.target)},this.domSubtreeModified=function(t){var n=t.target;e.translateTexts.need(n)?e.isNonIgnore(n)&&e.translateTexts.add(n):e.notCleanTextNodes&&(e.notCleanTextNodes=!1,setTimeout(e.cleanTextNodes,30))},this.loadTextNodes=function(){e.notLoadTextNodes=!0,document.head&&e.nodeHandler(document.head),document.body&&e.nodeHandler(document.body),e.doTranslate()},this.cleanTextNodes=function(){e.notCleanTextNodes=!0,e.translateTexts.clean(),e.translatePlaceholders.clean(),e.translateSubmits.clean()}};return h.prototype.isWatch=function(){return this.watch},h.prototype.getTranslateNode=function(){return this.translateNodes},h.prototype.getNonTranslateText=function(){return this.db.getNonTranslate()},h.prototype.reload=function(e){if(e)this.db.insert(e);else for(var t in window)-1!=t.indexOf(r.GroupPrefix)&&this.db.insert(window[t]);this.watch&&this.notLoadTextNodes&&(this.notLoadTextNodes=!1,setTimeout(this.loadTextNodes,30))},h.prototype.getLanguage=function(){return this.currentLanguage},h.prototype.getText=function(e){return"string"==typeof e?this.db.translate(e,this.currentLanguage):e},h.prototype.getTextByKey=function(e){return this.db.translateByKey(e,this.currentLanguage)},h.prototype.translate=function(e){this.currentLanguage!=e&&(this.db.hasLanguage(e)&&(this.currentLanguage=e),this.doTranslate())},h.prototype.start=function(){this.stop(),this.watch=!0,this.reload(),window.alert=this.proxyAlertHanlder,window.confirm=this.proxyConfirmHanlder,Element.prototype.setAttribute=this.buildProxySetAttribute(this),document.addEventListener("DOMNodeInserted",this.domNodeInserted),document.addEventListener("DOMSubtreeModified",this.domSubtreeModified),document.addEventListener("DOMNodeInsertedIntoDocument",this.domNodeInserted)},h.prototype.stop=function(){this.watch=!1,window.alert=this.windowAlert,window.confirm=this.windowConfirm,Element.prototype.setAttribute=this.elementSetAttributeOrigin,document.removeEventListener("DOMNodeInserted",this.domNodeInserted),document.removeEventListener("DOMSubtreeModified",this.domSubtreeModified),document.removeEventListener("DOMNodeInsertedIntoDocument",this.domNodeInserted)},h.prototype.buildProxySetAttribute=function(e){return function(t,n){switch(e.elementSetAttributeOrigin.apply(this,arguments),t=t.toLowerCase()){case r.Translatekey:this instanceof HTMLInputElement?e.translateSubmits.need(this)&&e.translateSubmits.add(this):this.innerText=n;break;case r.PlaceholderTranslatekey:e.translatePlaceholders.add(this);break;case r.Value:case r.Type:e.translateSubmits.need(this)&&e.translateSubmits.add(this)}}},h.prototype.isNonIgnore=function(e){if(e){if(e==document.documentElement)return!0;if(3==e.nodeType&&(e=s.getParentElement(e)),1==e.nodeType)return-1==r.IgnoreTagArray.indexOf(e.tagName)&&(null==e.getAttribute(r.IgnoreAttributeName)&&this.isNonIgnore(s.getParentElement(e)))}return!1},h.prototype.nodeHandler=function(e){if(this.isNonIgnore(e)){if(this.translateTexts.need(e))this.translateTexts.add(e);else if(this.translatePlaceholders.need(e))this.translatePlaceholders.add(e);else if(this.translateSubmits.need(e))this.translateSubmits.add(e);else{var t,n=e.getAttribute(r.Translatekey);void 0!=n&&(void 0!=(t=e.innerText)&&""!=t||(t=e.innerText=n))}this.loopNodes(e.childNodes)}},h.prototype.loopNodes=function(e){if(0!=e.length)for(var t=0,n=e.length;t<n;t++)this.nodeHandler(e[t])},h.prototype.doTranslate=function(){document.removeEventListener("DOMSubtreeModified",this.domSubtreeModified),this.translateTexts.doTranslate(this.currentLanguage),this.translatePlaceholders.doTranslate(this.currentLanguage),this.translateSubmits.doTranslate(this.currentLanguage),document.addEventListener("DOMSubtreeModified",this.domSubtreeModified)},e.getTranslateGO=t,e.TranslateGO=h,e}({});

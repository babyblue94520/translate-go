var TranslateModule=function(e){"use strict";function t(){return window[s.Prefix]?window[s.Prefix]:window[s.Prefix]=new c}var n=function(){};n.getParentElement=function(e){return void 0!=e.parentElement?e.parentElement:void 0!=e.parentNode?e.parentNode:void 0},n.isConnected=function(e){if(!e)return!1;if(void 0==e.isConnected){var t=n.getParentElement(e);return!!t&&(e==document.body||t==document.body||n.isConnected(t))}return e.isConnected};var r=function(){this._nodes=[]};r.prototype.indexOf=function(e){return this._nodes.indexOf(e)},r.prototype.getNodes=function(){return this._nodes},r.prototype.add=function(e){this._nodes.push(e)},r.prototype.remove=function(e){var t=this.indexOf(e);return-1!=t&&(this._nodes.splice(t,1),!0)},r.prototype.clean=function(){this._nodes=this._nodes.filter(n.isConnected)};var o=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.need=function(e){return void 0!=e.placeholder||""!=e.placeholder},t.prototype.getText=function(e){return e.placeholder},t.prototype.setText=function(e,t){t&&(e.placeholder=t)},t}(r),a=function(e){function t(){e.apply(this,arguments)}return e&&(t.__proto__=e),t.prototype=Object.create(e&&e.prototype),t.prototype.constructor=t,t.prototype.need=function(e){return 3==e.nodeType},t.prototype.getText=function(e){return e.data},t.prototype.setText=function(e,t){t&&(e.data=t)},t}(r),i={production:!1},s={Repeat:"repeat",Type:"type",Key:"key",IgnoreKeyArray:["key","type","repeat"],IgnoreTagArray:["SCRIPT","LINK","META","STYLE"],IgnoreAttributeName:"nottranslate",Translatekey:"translatekey",PlaceholderTranslatekey:"placeholdertranslatekey",Prefix:"__translateGO",GroupPrefix:"__translateGO_",ConfigPrefix:"__translateGOConfig"};console.log("TranslateConst.ConfigPrefix",window[s.ConfigPrefix]),void 0==window[s.ConfigPrefix]&&(window[s.ConfigPrefix]={dev:!i.production,defaultLanguage:"en"});var d,u=window[s.ConfigPrefix];!function(e){e[e.none=0]="none",e[e.key=1]="key"}(d||(d={}));var l=function(){this._specialChars="[.。:：;；!！?？{}()=＊*\\[\\]\\s\\r\\n]",this._startRegexStr="(^[{(＊*\\[\\s\\r\\n]?)",this._endRegexStr="([.。:：;；!！?？=＊*\\]\\s\\r\\n]?$)",this._cleanChars="[\\r\\n]",this._modifier="i",this._cleanRegex=new RegExp(this._cleanChars+"+","g"),this._textReplaceSpecialCharsRegex=new RegExp("("+this._specialChars+")","g"),this._wordSource={},this._keySource={},this._wordRegexs=[],this._textLanguageData={},this._langs=[],this._cacheNonTranslateText={}};l.prototype.getLanguages=function(){return this._langs},l.prototype.hasLanguage=function(e){return-1!=this._langs.indexOf(e)},l.prototype.insert=function(e){var t;for(var n in e){t=e[n];for(var r in t){var o=String(t[r]);r==s.Key?this._keySource[n]=t:(this._wordSource[o]=t,this._wordRegexs[o]=new RegExp(this._startRegexStr+this.getRegexText(o)+this._endRegexStr,this._modifier),this._textLanguageData[o]=r,u.dev&&delete this._cacheNonTranslateText[o])}}if(t)for(var a in t)a!=s.Key&&-1==this._langs.indexOf(a)&&this._langs.push(a)},l.prototype.getNonTranslate=function(){return this._cacheNonTranslateText},l.prototype.translate=function(e,t){var n=e;if((e=String(e)).length>0){var r=this.getWordSource(e);if(r)return r[t]||n;var o=this.getTranslateSource(e);if(r)return this.translateBySource(e,o,t)||n}return n},l.prototype.translateByKey=function(e,t){var n,r=this._keySource[e];return r&&(n=r[t]||n,r.currentLanguage=t,r.translateText=n,r.currentText=n),n},l.prototype.translateBySource=function(e,t,n){var r=t.wordSource[n];if(t.type==d.key)return t.currentLanguage=n,t.translateText=r,t.currentText=r,r;if(void 0!=r){var o=t.translateRegexs[t.currentLanguage];return t.currentLanguage=n,t.translateText=r,t.currentText=e.replace(o,"$1"+r+"$2"),t.currentText}},l.prototype.getTranslateSource=function(e){var t=this.getTextLanguage(e);if(t){var n={},r=this.getWordSource(t.text);if(r){for(var o in r)n[o]=this.getWordRegex(r[o]);return{type:d.none,translateText:t.text,currentLanguage:t.language,wordSource:r,translateRegexs:n,currentText:e}}}},l.prototype.getTranslateSourceByKey=function(e){var t=this._keySource[e];if(t)return{type:d.key,translateText:null,currentLanguage:null,wordSource:t,translateRegexs:null,currentText:null}},l.prototype.getTextLanguage=function(e){var t=this._textLanguageData[e];if(t)return{language:t,text:e};var n=this.getCleanText(e);if(0!=n.length){if(t=this._textLanguageData[n])return{language:t,text:n};for(var r in this._textLanguageData)if(this.getWordRegex(r).test(n))return{language:this._textLanguageData[r],text:r};if(u.dev&&n){var o=n.replace(/[&@#$%^\[\]'"～`~<>,，+-_.。:：;；!！?？{}()=＊*\/\[\]\s\r\n]/g,"");isNaN(Number(o))&&!/^[0-9]+$/.test(o)&&(this._cacheNonTranslateText[n]=!1)}}},l.prototype.getWordSource=function(e){return this._wordSource[e]},l.prototype.getWordRegex=function(e){return this._wordRegexs[e]},l.prototype.getCleanText=function(e){return e?e.replace(this._cleanRegex,"").replace(/(^[\s]+|[\s]+$)/g,""):e},l.prototype.getRegexText=function(e){return e.replace(this._textReplaceSpecialCharsRegex,"\\$1")};var c=function(){var e=this;this.watch=!1,this.db=new l,this.currentLanguage=u.defaultLanguage||navigator.language,this.translateTextNodes=new a,this.translatePlaceholderNodes=new o,this.windowAlert=window.alert,this.windowConfirm=window.confirm,this.elementSetAttributeOrigin=Element.prototype.setAttribute,this.proxyAlertHanlder=function(t){e.windowAlert.call(window,e.getText(t))},this.proxyConfirmHanlder=function(t){return e.windowConfirm.call(window,e.getText(t))},this.domNodeInserted=function(t){e.nodeHandler(t.target)},this.domSubtreeModified=function(t){var n=t.target;e.translateTextNodes.need(n)&&e.isNonIgnore(n)&&e.modifyAddNode(e.translateTextNodes,n)}};return c.prototype.isWatch=function(){return this.watch},c.prototype.getTranslateNode=function(){return this.translateTextNodes},c.prototype.getNonTranslateText=function(){return this.db.getNonTranslate()},c.prototype.reload=function(e){if(e)this.db.insert(e);else for(var t in window)-1!=t.indexOf(s.GroupPrefix)&&this.db.insert(window[t]);this.watch&&this.loadTextNodes()},c.prototype.getLanguage=function(){return this.currentLanguage},c.prototype.getText=function(e){return"string"==typeof e?this.db.translate(e,this.currentLanguage):e},c.prototype.getTextByKey=function(e){return this.db.translateByKey(e,this.currentLanguage)},c.prototype.translate=function(e){this.currentLanguage!=e&&this.db.hasLanguage(e)&&(this.currentLanguage=e,this.doTranslate())},c.prototype.start=function(){this.stop(),this.watch=!0,this.reload(),this.doTranslate(),window.alert=this.proxyAlertHanlder,window.confirm=this.proxyConfirmHanlder,Element.prototype.setAttribute=this.buildProxySetAttribute(this),document.addEventListener("DOMNodeInserted",this.domNodeInserted),document.addEventListener("DOMSubtreeModified",this.domSubtreeModified),document.addEventListener("DOMNodeInsertedIntoDocument",this.domNodeInserted)},c.prototype.stop=function(){this.watch=!1,window.alert=this.windowAlert,window.confirm=this.windowConfirm,Element.prototype.setAttribute=this.elementSetAttributeOrigin,document.removeEventListener("DOMNodeInserted",this.domNodeInserted),document.removeEventListener("DOMSubtreeModified",this.domSubtreeModified),document.removeEventListener("DOMNodeInsertedIntoDocument",this.domNodeInserted)},c.prototype.buildProxySetAttribute=function(e){return function(t,n){e.elementSetAttributeOrigin.apply(this,arguments),(t=t.toLowerCase())==s.Translatekey?this.innerText=n:t==s.PlaceholderTranslatekey&&e.addNode(e.translatePlaceholderNodes,this)}},c.prototype.isNonIgnore=function(e){if(e){if(e==document.documentElement)return!0;if(3==e.nodeType&&(e=n.getParentElement(e)),1==e.nodeType)return-1==s.IgnoreTagArray.indexOf(e.tagName)&&(null==e.getAttribute(s.IgnoreAttributeName)&&this.isNonIgnore(n.getParentElement(e)))}return!1},c.prototype.nodeHandler=function(e){this.isNonIgnore(e)&&(this.translateTextNodes.need(e)?this.addNode(this.translateTextNodes,e):this.translatePlaceholderNodes.need(e)&&this.addNode(this.translatePlaceholderNodes,e),this.loopNodes(e.childNodes))},c.prototype.loopNodes=function(e){if(0!=e.length)for(var t=0,n=e.length;t<n;t++)this.nodeHandler(e[t])},c.prototype.loadTextNodes=function(){document.head&&this.nodeHandler(document.head),document.body&&this.nodeHandler(document.body)},c.prototype.doTranslate=function(){this.translateTextNodes.clean();for(var e=this.translateTextNodes.getNodes(),t=0,n=e.length;t<n;t++)this.doTranslateNodesSetText(this.translateTextNodes,e[t]);this.translatePlaceholderNodes.clean();for(var r=0,o=(e=this.translatePlaceholderNodes.getNodes()).length;r<o;r++)this.doTranslateNodesSetText(this.translatePlaceholderNodes,e[r])},c.prototype.addNode=function(e,t){this.updateNode(e,t)||this.addTranslateSource(e,t)&&(this.doTranslateNodesSetText(e,t),e.add(t))},c.prototype.modifyAddNode=function(e,t){this.updateNode(e,t)||this.isCanAddNode(t)&&this.addTranslateSource(e,t)&&(this.doTranslateNodesSetText(e,t),e.add(t))},c.prototype.isCanAddNode=function(e){for(var t=e;(t=n.getParentElement(t))!=document.documentElement;)if(null!=t.getAttribute(s.IgnoreAttributeName))return!1;return!0},c.prototype.updateNode=function(e,t){if(t.translateTextSource){if(t.translateTextSource.currentText==e.getText(t))return!0;if(this.addTranslateSource(e,t))return this.doTranslateNodesSetText(e,t),!0}return!1},c.prototype.addTranslateSource=function(e,t){var r;if(3==t.nodeType?r=n.getParentElement(t).getAttribute(s.Translatekey):(r=t.getAttribute(s.Translatekey))?(t.innerText=r,r=null):r=n.getParentElement(t).getAttribute(s.PlaceholderTranslatekey),null!=r)return t.translateTextSource=this.db.getTranslateSourceByKey(r);var o=e.getText(t);return void 0!=o&&0!=String(o).length&&(t.translateTextSource=this.db.getTranslateSource(o))},c.prototype.doTranslateNodesSetText=function(e,t){var n=this.db.translateBySource(e.getText(t),t.translateTextSource,this.currentLanguage);e.setText(t,n)},e.getTranslateGO=t,e.TranslateGO=c,e}({});

var TranslateModule=function(e){"use strict";var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function n(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a,t,o=function(){function n(){}return n.getParentElement=function(e){return null!=e.parentElement?e.parentElement:null!=e.parentNode?e.parentNode:void 0},n.isConnected=function(e){if(!e)return!1;if(null==e.isConnected){var t=n.getParentElement(e);return!!t&&(e==document.body||t==document.body||n.isConnected(t))}return e.isConnected},n}(),i=function(){function e(){this._nodes=[]}return e.prototype.indexOf=function(e){return this._nodes.indexOf(e)},e.prototype.getNodes=function(){return this._nodes},e.prototype.add=function(e){this._nodes.push(e)},e.prototype.remove=function(e){var t=this.indexOf(e);return-1!=t&&(this._nodes.splice(t,1),!0)},e.prototype.clean=function(){this._nodes=this._nodes.filter(o.isConnected)},e}(),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.need=function(e){return null!=e.placeholder||""!=e.placeholder},t.prototype.getText=function(e){return e.placeholder},t.prototype.setText=function(e,t){t&&(e.placeholder=t)},t}(i),u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.need=function(e){return 3==e.nodeType},t.prototype.getText=function(e){return e.data},t.prototype.setText=function(e,t){t&&(e.data=t)},t}(i),d=function(){function e(){}return e.Repeat="repeat",e.Type="type",e.Key="key",e.IgnoreKeyArray=["key","type","repeat"],e.IgnoreTagArray=["SCRIPT","LINK","META","STYLE"],e.IgnoreAttributeName="nottranslate",e.Translatekey="translatekey",e.PlaceholderTranslatekey="placeholdertranslatekey",e.GroupPrefix=(e.Prefix="__translateGO")+"_",e.ConfigPrefix="__translateConfig",e}(),l={dev:!1,defaultLanguage:"en"};window[d.ConfigPrefix]=l,(t=a||(a={}))[t.none=0]="none",t[t.key=1]="key";var c=function(){function e(){this._specialChars="[.。:：;；!！?？{}()=＊*\\[\\]\\s\\r\\n]",this._startRegexStr="(^[{(＊*\\[\\s\\r\\n]?)",this._endRegexStr="([.。:：;；!！?？=＊*\\]\\s\\r\\n]?$)",this._cleanChars="[\\r\\n]",this._modifier="i",this._cleanRegex=new RegExp(this._cleanChars+"+","g"),this._textReplaceSpecialCharsRegex=new RegExp("("+this._specialChars+")","g"),this._wordSource={},this._keySource={},this._wordRegexs=[],this._textLanguageData={},this._langs=[],this._cacheNonTranslateText={}}return e.prototype.getLanguages=function(){return this._langs},e.prototype.hasLanguage=function(e){return-1!=this._langs.indexOf(e)},e.prototype.insert=function(e){var t,n=this;for(var r in e)for(var o in t=e[r]){var a=String(t[o]);o==d.Key?n._keySource[r]=t:(n._wordSource[a]=t,n._wordRegexs[a]=new RegExp(n._startRegexStr+n.getRegexText(a)+n._endRegexStr,n._modifier),n._textLanguageData[a]=o,l.dev&&delete n._cacheNonTranslateText[a])}if(t)for(var o in t)o!=d.Key&&-1==n._langs.indexOf(o)&&n._langs.push(o)},e.prototype.getNonTranslate=function(){return this._cacheNonTranslateText},e.prototype.translate=function(e,t){var n=e;if(0<(e=String(e)).length){var r=this.getWordSource(e);if(r)return r[t]||n;var o=this.getTranslateSource(e);if(r)return this.translateBySource(e,o,t)||n}return n},e.prototype.translateByKey=function(e,t){var n,r=this._keySource[e];return r&&(n=r[t]||n,r.currentLanguage=t,r.translateText=n,r.currentText=n),n},e.prototype.translateBySource=function(e,t,n){var r=t.wordSource[n];if(t.type==a.key)return t.currentLanguage=n,t.translateText=r,t.currentText=r;if(null!=r){var o=t.translateRegexs[t.currentLanguage];return t.currentLanguage=n,t.translateText=r,t.currentText=e.replace(o,"$1"+r+"$2"),t.currentText}},e.prototype.getTranslateSource=function(e){var t=this.getTextLanguage(e);if(t){var n={},r=this.getWordSource(t.text);if(r){for(var o in r)n[o]=this.getWordRegex(r[o]);return{type:a.none,translateText:t.text,currentLanguage:t.language,wordSource:r,translateRegexs:n,currentText:e}}}},e.prototype.getTranslateSourceByKey=function(e){var t=this._keySource[e];if(t)return{type:a.key,translateText:null,currentLanguage:null,wordSource:t,translateRegexs:null,currentText:null}},e.prototype.getTextLanguage=function(e){var t=this._textLanguageData[e];if(t)return{language:t,text:e};var n=this.getCleanText(e);if(0!=n.length){if(t=this._textLanguageData[n])return{language:t,text:n};for(var r in this._textLanguageData)if(this.getWordRegex(r).test(n))return{language:this._textLanguageData[r],text:r};if(l.dev&&n){var o=n.replace(/[&@#$%^\[\]'"～`~<>,，+-_.。:：;；!！?？{}()=＊*\/\[\]\s\r\n]/g,"");isNaN(Number(o))&&!/^[0-9]+$/.test(o)&&(this._cacheNonTranslateText[n]=!1)}}},e.prototype.getWordSource=function(e){return this._wordSource[e]},e.prototype.getWordRegex=function(e){return this._wordRegexs[e]},e.prototype.getCleanText=function(e){return e?e.replace(this._cleanRegex,"").replace(/(^[\s]+|[\s]+$)/g,""):e},e.prototype.getRegexText=function(e){return e.replace(this._textReplaceSpecialCharsRegex,"\\$1")},e}();var h=function(){function e(){var n=this;this.watch=!1,this.db=new c,this.currentLanguage=l.defaultLanguage||navigator.language,this.translateTextNodes=new u,this.translatePlaceholderNodes=new s,this.windowAlert=window.alert,this.windowConfirm=window.confirm,this.elementSetAttributeOrigin=Element.prototype.setAttribute,this.proxyAlertHanlder=function(e){n.windowAlert.call(window,n.getText(e))},this.proxyConfirmHanlder=function(e){return n.windowConfirm.call(window,n.getText(e))},this.domNodeInserted=function(e){n.nodeHandler(e.target)},this.domSubtreeModified=function(e){var t=e.target;n.translateTextNodes.need(t)&&n.isNonIgnore(t)&&n.modifyAddNode(n.translateTextNodes,t)}}return e.prototype.isWatch=function(){return this.watch},e.prototype.getTranslateNode=function(){return this.translateTextNodes},e.prototype.getNonTranslateText=function(){return this.db.getNonTranslate()},e.prototype.reload=function(e){if(e)this.db.insert(e);else for(var t in window)-1!=t.indexOf(d.GroupPrefix)&&this.db.insert(window[t]);this.watch&&this.loadTextNodes()},e.prototype.getLanguage=function(){return this.currentLanguage},e.prototype.getText=function(e){return"string"==typeof e?this.db.translate(e,this.currentLanguage):e},e.prototype.getTextByKey=function(e){return this.db.translateByKey(e,this.currentLanguage)},e.prototype.translate=function(e){this.currentLanguage!=e&&this.db.hasLanguage(e)&&(this.currentLanguage=e,this.doTranslate())},e.prototype.start=function(){this.stop(),this.watch=!0,this.reload(),this.doTranslate(),window.alert=this.proxyAlertHanlder,window.confirm=this.proxyConfirmHanlder,Element.prototype.setAttribute=this.buildProxySetAttribute(this),document.addEventListener("DOMNodeInserted",this.domNodeInserted),document.addEventListener("DOMSubtreeModified",this.domSubtreeModified),document.addEventListener("DOMNodeInsertedIntoDocument",this.domNodeInserted)},e.prototype.stop=function(){this.watch=!1,window.alert=this.windowAlert,window.confirm=this.windowConfirm,Element.prototype.setAttribute=this.elementSetAttributeOrigin,document.removeEventListener("DOMNodeInserted",this.domNodeInserted),document.removeEventListener("DOMSubtreeModified",this.domSubtreeModified),document.removeEventListener("DOMNodeInsertedIntoDocument",this.domNodeInserted)},e.prototype.buildProxySetAttribute=function(n){return function(e,t){n.elementSetAttributeOrigin.apply(this,arguments),(e=e.toLowerCase())==d.Translatekey?this.innerText=t:e==d.PlaceholderTranslatekey&&n.addNode(n.translatePlaceholderNodes,this)}},e.prototype.isNonIgnore=function(e){if(e){if(e==document.documentElement)return!0;if(3==e.nodeType&&(e=o.getParentElement(e)),1==e.nodeType)return-1==d.IgnoreTagArray.indexOf(e.tagName)&&(null==e.getAttribute(d.IgnoreAttributeName)&&this.isNonIgnore(o.getParentElement(e)))}return!1},e.prototype.nodeHandler=function(e){this.isNonIgnore(e)&&(this.translateTextNodes.need(e)?this.addNode(this.translateTextNodes,e):this.translatePlaceholderNodes.need(e)&&this.addNode(this.translatePlaceholderNodes,e),this.loopNodes(e.childNodes))},e.prototype.loopNodes=function(e){if(0!=e.length)for(var t=0,n=e.length;t<n;t++)this.nodeHandler(e[t])},e.prototype.loadTextNodes=function(){document.head&&this.nodeHandler(document.head),document.body&&this.nodeHandler(document.body)},e.prototype.doTranslate=function(){this.translateTextNodes.clean();for(var e=this.translateTextNodes.getNodes(),t=0,n=e.length;t<n;t++)this.doTranslateNodesSetText(this.translateTextNodes,e[t]);this.translatePlaceholderNodes.clean();for(t=0,n=(e=this.translatePlaceholderNodes.getNodes()).length;t<n;t++)this.doTranslateNodesSetText(this.translatePlaceholderNodes,e[t])},e.prototype.addNode=function(e,t){this.updateNode(e,t)||this.addTranslateSource(e,t)&&(this.doTranslateNodesSetText(e,t),e.add(t))},e.prototype.modifyAddNode=function(e,t){this.updateNode(e,t)||this.isCanAddNode(t)&&this.addTranslateSource(e,t)&&(this.doTranslateNodesSetText(e,t),e.add(t))},e.prototype.isCanAddNode=function(e){for(var t=e;(t=o.getParentElement(t))!=document.documentElement;)if(null!=t.getAttribute(d.IgnoreAttributeName))return!1;return!0},e.prototype.updateNode=function(e,t){if(t.translateTextSource){if(t.translateTextSource.currentText==e.getText(t))return!0;if(this.addTranslateSource(e,t))return this.doTranslateNodesSetText(e,t),!0}return!1},e.prototype.addTranslateSource=function(e,t){var n;if(3==t.nodeType?n=o.getParentElement(t).getAttribute(d.Translatekey):(n=t.getAttribute(d.Translatekey))?(t.innerText=n,n=null):n=o.getParentElement(t).getAttribute(d.PlaceholderTranslatekey),null!=n)return t.translateTextSource=this.db.getTranslateSourceByKey(n);var r=e.getText(t);return null!=r&&0!=String(r).length&&(t.translateTextSource=this.db.getTranslateSource(r))},e.prototype.doTranslateNodesSetText=function(e,t){var n=this.db.translateBySource(e.getText(t),t.translateTextSource,this.currentLanguage);e.setText(t,n)},e}();return e.getTranslateGO=function(){return window[d.Prefix]?window[d.Prefix]:window[d.Prefix]=new h},e.TranslateGO=h,e}({});
